<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>檔案上傳</title>
</head>
<body>
    <h1>上傳檔案到 GitHub</h1>
    <form id="uploadForm">
        <input type="file" id="fileInput" required>
        <button type="submit">上傳</button>
    </form>
    <div id="message"></div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // 防止表單的默認提交行為

            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('請選擇一個檔案');
                return;
            }

            const reader = new FileReader();
            reader.onload = async () => {
                const content = btoa(String.fromCharCode(...new Uint8Array(reader.result))); // 將檔案內容轉為 base64

                // 觸發 GitHub Actions
                const url = 'https://api.github.com/repos/DongShanSalmon/DongShanSalmon.github.io/actions/workflows/deploy.yml/dispatches';

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Authorization': `token YOUR_PERSONAL_ACCESS_TOKEN`, // 在這裡替換為你的 GitHub Token（在測試時使用）
                            'Accept': 'application/vnd.github.v3+json',
                        },
                        body: JSON.stringify({
                            ref: 'main', // 目標分支
                            inputs: {
                                fileName: file.name,
                                content: content,
                            },
                        }),
                    });

                    if (response.ok) {
                        document.getElementById('message').textContent = '檔案上傳請求成功！';
                    } else {
                        const errorData = await response.json();
                        document.getElementById('message').textContent = `上傳失敗：${errorData.message}`;
                    }
                } catch (error) {
                    document.getElementById('message').textContent = `發生錯誤：${error.message}`;
                }
            };

            reader.readAsArrayBuffer(file); // 使用 readAsArrayBuffer 來讀取檔案
        });
    </script>
</body>
</html>
